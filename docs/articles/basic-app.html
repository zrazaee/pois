<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic application • pois</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Basic application">
<meta property="og:description" content="pois">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pois</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-app.html">Basic application</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="basic-app_files/header-attrs-2.5.2/header-attrs.js"></script><script src="basic-app_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="basic-app_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="basic-app_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basic application</h1>
            
      
      
      <div class="hidden name"><code>basic-app.Rmd</code></div>

    </div>

    
    
<p>First, some setup, though the <code>RNGkind</code> does not seem to resolve the reproducibility issue of <code>mclapply</code>!</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">pois</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://Matrix.R-forge.R-project.org/">Matrix</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot">corrplot</a></span><span class="op">)</span>
<span class="co">#&gt; corrplot 0.84 loaded</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">RNGkind</a></span><span class="op">(</span><span class="st">"L'Ecuyer-CMRG"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></pre></div>
<p>Let us now load some data. <code>simcctox</code> is a simulated dataset avaialbe in the package. It is simulated from a POIS model fitted to a real toxicity data. We pick a ranfom subsample of size 150 from simcctox dataset as a toy example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">X</span> <span class="op">=</span> <span class="va">simcctox</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">simcctox</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span>, <span class="op">]</span> <span class="co"># </span>
<span class="va">X</span> <span class="op">=</span> <span class="fu">order_cols_by_freq</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span> <span class="co"># order columns by frequency and pick the first 12</span></pre></div>
<p>We check whether any column has 0 or 1 observations. <code>glmnet</code> would complain in this case:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu">check_01_cols</span><span class="op">(</span><span class="va">X</span><span class="op">)</span>  <span class="co"># check whether any columns has 0 or 1 observations</span>
<span class="co">#&gt; [1] FALSE</span></pre></div>
<p>The 0-1 issue could still happen during CV-subsampling, even if the original data has passed the test. The code does not check for that right now (or try to resample to avoid it), so better check to make sure the column sums are large enough:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
<span class="co">#&gt; Lycd Drmr Drrh Fatg Anlp Anrx Rctp Bckp Anem Wbcd Abdp Rmc- </span>
<span class="co">#&gt;   81   57   53   44   34   29   26   23   20   19   15   15</span></pre></div>
<p>We can now fit the POIS model with pair-complement MMD cross-validation:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_pois_glmnet_mmdcv.html">fit_pois_glmnet_mmdcv</a></span><span class="op">(</span><span class="va">X</span>, nlam <span class="op">=</span> <span class="fl">5</span>, nreps <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> 
<span class="co">#&gt; --- Starting CV ---</span>
<span class="co">#&gt; Rep 1/3 ... </span>
<span class="co">#&gt; POIS: glment, global, nocv ... 0.233 (s).</span>
<span class="co">#&gt; lam = 1.00e-04    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.5 (s).  value = 0.219]</span>
<span class="co">#&gt; lam = 4.73e-04    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.3 (s).  value = 0.156]</span>
<span class="co">#&gt; lam = 2.24e-03    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.3 (s).  value = 0.103]</span>
<span class="co">#&gt; lam = 1.06e-02    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.068]</span>
<span class="co">#&gt; lam = 5.01e-02    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.3 (s).  value = 0.126]</span>
<span class="co">#&gt; Rep 2/3 ... </span>
<span class="co">#&gt; POIS: glment, global, nocv ... 0.231 (s).</span>
<span class="co">#&gt; lam = 1.00e-04    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.183]</span>
<span class="co">#&gt; lam = 4.73e-04    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.101]</span>
<span class="co">#&gt; lam = 2.24e-03    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.075]</span>
<span class="co">#&gt; lam = 1.06e-02    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.034]</span>
<span class="co">#&gt; lam = 5.01e-02    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.030]</span>
<span class="co">#&gt; Rep 3/3 ... </span>
<span class="co">#&gt; POIS: glment, global, nocv ... 0.196 (s).</span>
<span class="co">#&gt; lam = 1.00e-04    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.005]</span>
<span class="co">#&gt; lam = 4.73e-04    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.023]</span>
<span class="co">#&gt; lam = 2.24e-03    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.010]</span>
<span class="co">#&gt; lam = 1.06e-02    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.051]</span>
<span class="co">#&gt; lam = 5.01e-02    [Computing pair-comp. MMD (nBasis = 64, nPairs = 66) ... 0.2 (s).  value = 0.091]</span>
<span class="co">#&gt; --- End of CV --- Chose lam = 0.01</span>
<span class="co">#&gt; Fitting the final model ... </span>
<span class="co">#&gt; POIS: glment, global, nocv ... 0.204 (s).</span>
<span class="va">opt_idx</span> <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">opt_idx</span>
<span class="fu">printf</span><span class="op">(</span><span class="st">'Optimal model = #%d, with lambda = %3.2e'</span>, <span class="va">opt_idx</span>, <span class="va">out</span><span class="op">$</span><span class="va">opt_lambda</span><span class="op">)</span>
<span class="co">#&gt; Optimal model = #4, with lambda = 1.06e-02</span></pre></div>
<p>Let us also plot the regularization curve (pair-complement MMDvs. <span class="math inline">\(\lambda\)</span>):</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">lambda</span>, <span class="va">out</span><span class="op">$</span><span class="va">reg_curve</span>, log <span class="op">=</span> <span class="st">"x"</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"lambda"</span>, ylab<span class="op">=</span><span class="st">"pair-complement MMD"</span><span class="op">)</span></pre></div>
<p><img src="basic-app_files/figure-html/Plot%20reg.%20curve-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Let us pick a less regularized model that what CV gives …</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">model</span> <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">models</span><span class="op">[[</span><span class="va">opt_idx</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="co"># We tend to over-regularize, pick a less regularized model</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="co">#&gt; Pois model with dimension = 12 and # of levels 4.</span>
<span class="co">#&gt; Pervalance of -Inf in Theta = 0.479167</span></pre></div>
<p>… and plot its <span class="math inline">\(\Gamma\)</span> paramter, i.e., POIS’s the interaction matrix:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">corr_type</span> <span class="op">=</span> <span class="st">"upper"</span> <span class="co"># "full"</span>
<span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">Gamma</span>, is.corr <span class="op">=</span> <span class="cn">F</span>, type<span class="op">=</span><span class="va">corr_type</span>, method <span class="op">=</span> <span class="st">"square"</span>, 
         tl.cex <span class="op">=</span> <span class="fl">0.8</span>, tl.col <span class="op">=</span> <span class="st">"black"</span>, diag <span class="op">=</span> <span class="cn">F</span>,
         col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"gray"</span>,<span class="st">"red"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="basic-app_files/figure-html/Gamma%20plot-1.png" width="384" style="display: block; margin: auto;"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zahra S. Razaee.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
